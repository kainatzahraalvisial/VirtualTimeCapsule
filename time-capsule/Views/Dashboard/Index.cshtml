@{
    ViewData["Title"] = "Dashboard";
    ViewData["DashboardSection"] = "Welcome";
    ViewData["IsLoggedIn"] = true; // Placeholder; replace with JWT authentication check
    ViewData["UserFirstName"] = "Zahra"; // Placeholder; replace with JWT claim
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<main class="dashboard-content p-4">
    <div id="particles-js" class="position-absolute top-0 start-0 w-100 h-100"></div>
    <div class="main-content-area">
        <h2 class="mb-4">Welcome, @ViewData["UserFirstName"]!</h2>
        <p>This is your cosmic dashboard. Click a sidebar option to get started.</p>
    </div>
</main>

<style>
    .dashboard-content {
        margin-left: 250px; /* Adjust for sidebar width */
        min-height: calc(100vh - 140px); /* Adjust for navbar and footer */
        position: relative;
        overflow: hidden;
    }

    #particles-js {
        z-index: 0;
    }

    .main-content-area {
        padding: 20px;
        background: rgba(255, 255, 255, 0.1); /* Frosted glass effect */
        backdrop-filter: blur(10px);
        border: 1px solid rgba(255, 255, 255, 0.2);
        border-radius: 10px;
        min-height: 300px;
        display: flex;
        flex-direction: column;
        justify-content: center;
        align-items: center;
        text-align: center;
        position: relative;
        z-index: 1;
        transition: background 0.3s, color 0.3s; /* For theme toggle */
    }

    .light-mode .main-content-area {
        background: rgba(255, 255, 255, 0.7);
        color: #333;
        border: 1px solid rgba(0, 0, 0, 0.2);
    }
</style>

@section Scripts {
    <script>
        console.log('Initializing Particles.js');
        particlesJS("particles-js", {
            particles: {
                number: { value: 100, density: { enable: true, value_area: 800 } },
                color: { value: "#C4AB83" },
                shape: { type: "circle" },
                opacity: { value: 1, random: false },
                size: { value: 3, random: true },
                line_linked: {
                    enable: true,
                    distance: 150,
                    color: "#8D695D",
                    opacity: 1,
                    width: 1
                },
                move: { enable: true, speed: 2, direction: "none", random: true }
            },
            interactivity: {
                detect_on: "canvas",
                events: {
                    onhover: { enable: true, mode: "grab" },
                    onclick: { enable: true, mode: "push" },
                    resize: true
                },
                modes: {
                    grab: { distance: 300, line_linked: { opacity: 1 } },
                    push: { particles_nb: 4 }
                }
            },
            retina_detect: true
        });

        document.getElementById('particles-js').addEventListener('mousemove', function() {
            console.log('Mouse moved over particles-js');
        });

        document.addEventListener('DOMContentLoaded', () => {
            const sidebarLinks = document.querySelectorAll('.sidebar .nav-link');
            const mainContent = document.querySelector('.main-content-area');
            const themeToggle = document.getElementById('themeToggle');
            const themeLabel = document.querySelector('.theme-label');
            const body = document.body;

            // Sidebar navigation
            sidebarLinks.forEach(link => {
                link.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = link.getAttribute('data-section');
                    if (section === "Logout") {
                        window.location.href = "/Account/Logout";
                        return;
                    }
                    let content = '';
                    switch (section) {
                        case 'Welcome':
                            content = `<h2>Welcome, @ViewData["UserFirstName"]!</h2><p>This is your cosmic dashboard. Click a sidebar option to get started.</p>`;
                            break;
                        case 'MyCapsules':
                            content = `<h2>My Capsules</h2><p>[Placeholder: List of capsules with title, creation date, unlock date, and delete button. Capsules with remaining time cannot be opened.]</p>`;
                            break;
                        case 'CreateCapsule':
                            content = `<h2>Create Capsule</h2><p>[Placeholder: Form to create a new capsule with title, content, and unlock date.]</p>`;
                            break;
                        case 'Notifications':
                            content = `<h2>Notifications</h2><p>[Placeholder: List of notifications, e.g., "Capsule ready to open", "Cannot open yet"]</p>`;
                            break;
                        case 'Profile':
                            content = `<h2>Profile</h2><p>[Placeholder: Profile picture upload and user details.]</p>`;
                            break;
                    }
                    mainContent.innerHTML = content;
                    sidebarLinks.forEach(l => l.classList.remove('active'));
                    link.classList.add('active');
                });
            });

            // Theme toggle
            themeToggle.addEventListener('change', () => {
                if (themeToggle.checked) {
                    body.classList.remove('light-mode');
                    themeLabel.textContent = 'Dark Mode';
                } else {
                    body.classList.add('light-mode');
                    themeLabel.textContent = 'Light Mode';
                }
            });
        });
    </script>
}